@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentservice.IdentifyClientPageConfig
@import uk.gov.hmrc.agentinvitationsfrontend.refactored.views.html._
@import uk.gov.hmrc.agentinvitationsfrontend.refactored.views.html.components._
@import uk.gov.hmrc.hmrcfrontend.views.Implicits.RichErrorSummary
@import uk.gov.hmrc.agentinvitationsfrontend.util.ViewUtils.dateErrorMapping
@import uk.gov.hmrc.agentinvitationsfrontend.refactored.controllers.routes
@import uk.gov.hmrc.agentinvitationsfrontend.config.ExternalUrls
@import uk.gov.hmrc.hmrcfrontend.config.ContactFrontendConfig
@import uk.gov.hmrc.agentservice.FormFieldInputType

@this(
        mainTemplate: main_template,
        errorPrefix: error_prefix,
        govukErrorSummary: GovukErrorSummary,
        govukFieldset: GovukFieldset,
        formWithCSRF: FormWithCSRF,
        inputText: input_text,
        inputDate: input_date,
        submitButton: submit_button,
        p: p_elem,
)


@(identifyClientPageConfig: IdentifyClientPageConfig, isDeAuthJourney: Boolean = false)(implicit request: Request[_], msgs: Messages, externalUrls: ExternalUrls, contactFrontendConfig: ContactFrontendConfig)

@knownFact = @{
 identifyClientPageConfig.knownFactConfig.map(config => config.formFieldInputType match {
  case FormFieldInputType.text =>
   inputText(
    field = identifyClientPageConfig.form("knownFact"),
    label = msgs(s"identify-client.knownFact.label.${identifyClientPageConfig.service}"),
    labelClass = Some("govuk-label--s"),
    hint = if(config.hintRequired) Some(msgs(s"identify-client.knownFact.hint.${identifyClientPageConfig.service}")) else None,
    autocomplete = config.autoComplete,
    inputClass = Some("govuk-input--width-20")
   )
  case FormFieldInputType.date =>
   inputDate(
    field = identifyClientPageConfig.form("knownFact"),
    legend = msgs(s"identify-client.knownFact.label.${identifyClientPageConfig.service}"),
    hint = if(config.hintRequired) Some(msgs(s"identify-client.knownFact.hint.${identifyClientPageConfig.service}")) else None
   )
 }
 )
}

@fieldsetHtml = {

@p(id = Some("identify-client-hint"), key = s"identify-client.p1.${identifyClientPageConfig.service}")

@inputText(
 field = identifyClientPageConfig.form("clientId"),
 label = msgs(s"identify-client.clientId.label.${identifyClientPageConfig.service}"),
 labelClass = Some("govuk-label--s"),
 hint = if(identifyClientPageConfig.clientIdConfig.hintRequired) Some(msgs(s"identify-client.clientId.hint.${identifyClientPageConfig.service}")) else None,
 inputClass = Some("govuk-input--width-10"),
 pattern = identifyClientPageConfig.clientIdConfig.inputPattern,
 inputMode = identifyClientPageConfig.clientIdConfig.inputMode
)
@knownFact.getOrElse("")
}


@mainTemplate(
 bannerTitle = msgs("message"),
 title = errorPrefix(identifyClientPageConfig.form) + msgs("generic.title", msgs("identify-client.header"), msgs("message")),
 isAgent = true,
 backLinkHref = Some("/backLinkUrl")
) {

 @if(identifyClientPageConfig.knownFactConfig.exists(_.formFieldInputType == FormFieldInputType.date) && identifyClientPageConfig.form.hasErrors) {
  @govukErrorSummary(ErrorSummary().withFormErrorsAsText(identifyClientPageConfig.form, mapping = dateErrorMapping("registrationDate", identifyClientPageConfig.form)))
 } else { @if(identifyClientPageConfig.form.hasErrors) {
  @govukErrorSummary(ErrorSummary().withFormErrorsAsText(identifyClientPageConfig.form))
 }
 }

 @formWithCSRF(action = routes.CreateInvitationController.submitIdentifyClient(identifyClientPageConfig.service)) {

  @govukFieldset(Fieldset(
   legend = Some(Legend(
    content = Text(msgs("identify-client.header")),
    classes = "govuk-fieldset__legend--xl",
    isPageHeading = true
   )),
   describedBy = Some("identify-client-hint"),
   html = fieldsetHtml
  ))

  @submitButton()

 }
}


