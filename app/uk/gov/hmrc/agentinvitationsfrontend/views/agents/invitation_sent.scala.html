@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.Configuration
@import uk.gov.hmrc.hmrcfrontend.config.ContactFrontendConfig
@import uk.gov.hmrc.agentinvitationsfrontend.config.ExternalUrls
@import uk.gov.hmrc.agentinvitationsfrontend.util.DisplayDateUtils._
@import uk.gov.hmrc.agentinvitationsfrontend.views.agents.InvitationSentPageConfig
@import uk.gov.hmrc.agentinvitationsfrontend.views.html._
@import views.html.helper.CSPNonce

@this(mainTemplate: MainTemplate)

@(config: InvitationSentPageConfig)(implicit request: Request[_], msgs: Messages, configuration: Configuration, externalUrls: ExternalUrls, contactFrontendConfig: ContactFrontendConfig)

@gtmScript = {
    <script @{CSPNonce.attr}>
           @for(service <- config.services){
               window.dataLayer.push({
                   'event': 'custom_agents_request',
                   'agents_event_category' : 'invitation',
                  'agents_event_action' : 'sent',
                  'agents_event_label' : '@service'
               });
           }
    </script>
}

@invitationLink = @{s"${externalUrls.agentInvitationsExternalUrl}${config.relativeInvitationUrl}"}

@mainTemplate(
title = msgs("generic.title", msgs("invitation-sent.header"), msgs("service.name.agents.auth")),
completedInviteGoSurvey = Some(true),
scriptElem = Some(gtmScript),
isAgent = true) {

    <h1 class="govuk-heading-xl">@msgs("invitation-sent.header")</h1>

    @if(config.isAltItsa) {
        <p>@msgs("invitation-sent.all-steps")</p>
    }

    <ol class="govuk-list govuk-list--number govuk-list--spaced">
        @if(config.step1Instructions.isDefined){
        <li>@config.step1Instructions.get</li>
        }

        <li>
            <p>@msgs("invitation-sent.link-text")</p>
            <strong id="invitationUrl" class="govuk-warning-text__text word-wrap">@invitationLink</strong>
        </li>

        <li>@msgs("invitation-sent.select-link")</li>
        <li>
            <p>@msgs("invitation-sent.client-respond", displayDateForLang(config.expiryDate), config.agencyEmail)</p>
            @if(config.showWarning) {
                <div class="govuk-warning-text">
                    <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
                    <span class="govuk-warning-text__assistive">Warning</span>
                    <strong class="govuk-warning-text__text">@msgs("invitation-sent.client-warning")</strong>
                </div>
            }
        </li>
        @if(config.isAltItsa) {
            <li><a href="https://www.gov.uk/guidance/sign-up-your-client-for-making-tax-digital-for-income-tax" id="signUpYourClient" target="_blank" rel="noreferrer noopener">@msgs("invitation-sent.mtd")</a></li>
        }
    </ol>

    <h2>@msgs("invitation-sent.further-help.heading")</h2>
    <p>@msgs("invitation-sent.further-help.p")</p>
    <ul class="govuk-list govuk-list--bullet govuk-list--spaced">
        <li><a href="https://www.gov.uk/guidance/authorise-an-agent-to-deal-with-certain-tax-services-for-you" id="stepByStep" target="_blank" rel="noreferrer noopener">@msgs("invitation-sent.further-help.link-text.sbs")</a></li>
        <li><a href="@config.continueUrl" id="continue">@msgs("invitation-sent.further-help.link-text.asa")</a></li>
    </ul>

}