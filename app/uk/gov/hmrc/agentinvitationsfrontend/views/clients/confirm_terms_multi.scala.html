@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.Configuration
@import uk.gov.hmrc.hmrcfrontend.config.ContactFrontendConfig
@import uk.gov.hmrc.agentinvitationsfrontend.config.ExternalUrls
@import uk.gov.hmrc.agentinvitationsfrontend.models.ConfirmedTerms
@import uk.gov.hmrc.agentinvitationsfrontend.util.DisplayDateUtils._
@import uk.gov.hmrc.agentinvitationsfrontend.views.clients.ConfirmTermsPageConfig
@import uk.gov.hmrc.agentinvitationsfrontend.views.html._
@import uk.gov.hmrc.agentinvitationsfrontend.views.html.agents._
@import uk.gov.hmrc.agentinvitationsfrontend.views.html.components.{SubmitButton, InputSingleCheckbox}
@import uk.gov.hmrc.govukfrontend.views.html.components.{GovukErrorSummary, ErrorSummary, FormWithCSRF, Text}
@import uk.gov.hmrc.govukfrontend.views.html.components.implicits._
@import uk.gov.hmrc.hmrcfrontend.views.html.components.implicits._

@this(
    mainTemplate: MainTemplate,
    errorPrefix: error_prefix,
    govukErrorSummary: GovukErrorSummary,
    formHelper: FormWithCSRF,
    submitButton: SubmitButton,
    inputSingleCheckbox: InputSingleCheckbox
)

@(confirmTermsForm: Form[ConfirmedTerms], pageConfig: ConfirmTermsPageConfig, changingConsent: Boolean = false)(implicit request: Request[_], messages: Messages, configuration: Configuration, externalUrls: ExternalUrls, contactFrontendConfig: ContactFrontendConfig)

@itsaTerms = {
    <span class="checkbox-heading govuk-!-margin-bottom-4">@Messages("confirm-terms-multi.itsa.p1", pageConfig.agencyName)</span>
    <ul class="govuk-list govuk-list--bullet">
        <li>@Messages("confirm-terms-multi.itsa.list.item7")</li>
        <li>@Messages("confirm-terms-multi.itsa.list.item1")</li>
        <li>@Messages("confirm-terms-multi.itsa.list.item2")</li>
        <li>@Messages("confirm-terms-multi.itsa.list.item3")</li>
        <li>@Messages("confirm-terms-multi.itsa.list.item4")</li>
        <li>@Messages("confirm-terms-multi.itsa.list.item5")</li>
        <li>@Messages("confirm-terms-multi.itsa.list.item6")</li>
        <li>@Messages("confirm-terms-multi.itsa.list.item8")</li>
        <li>@Messages("confirm-terms-multi.itsa.list.item9")</li>
        <li>@Messages("confirm-terms-multi.itsa.list.item10")</li>
    </ul>
}

@pirTerms = {
    <span class="checkbox-heading govuk-!-margin-bottom-4">@Messages("confirm-terms-multi.pir.p1", pageConfig.agencyName)</span>
    <ul class="govuk-list govuk-list--bullet">
        <li>@Messages("confirm-terms-multi.pir.list.item1")</li>
        <li>@Messages("confirm-terms-multi.pir.list.item2")</li>
        <li>@Messages("confirm-terms-multi.pir.list.item3")</li>
        <li>@Messages("confirm-terms-multi.pir.list.item4")</li>
    </ul>
}

@vatTerms = {
    <span class="checkbox-heading govuk-!-margin-bottom-4">@Messages("confirm-terms-multi.vat.p1", pageConfig.agencyName)</span>
    <ul class="govuk-list govuk-list--bullet">
        <li>@Messages("confirm-terms-multi.vat.list.item1")</li>
        <li>@Messages("confirm-terms-multi.vat.list.item2")</li>
        <li>@Messages("confirm-terms-multi.vat.list.item3")</li>
        <li>@Messages("confirm-terms-multi.vat.list.item4")</li>
        <li>@Messages("confirm-terms-multi.vat.list.item5")</li>
        <li>@Messages("confirm-terms-multi.vat.list.item6")</li>
        <li>@Messages("confirm-terms-multi.vat.list.item7")</li>
        <li>@Messages("confirm-terms-multi.vat.list.item8")
        <ul class="govuk-list govuk-list--bullet">
            <li>@Messages("confirm-terms-multi.vat.list.item9")</li>
            <li>@Messages("confirm-terms-multi.vat.list.item10")</li>
            <li>@Messages("confirm-terms-multi.vat.list.item11")</li>
            <li>@Messages("confirm-terms-multi.vat.list.item12")</li>
        </ul>
        </li>
    </ul>
}

@trustTerms = {
    <span class="checkbox-heading govuk-!-margin-bottom-4">@Messages("confirm-terms-multi.trust.p1", pageConfig.agencyName)</span>
    <ul class="govuk-list govuk-list--bullet">
        <li>@Messages("confirm-terms-multi.trust.list.item1")</li>
        <li>@Messages("confirm-terms-multi.trust.list.item2")</li>
    </ul>
}

@trustNTTerms = {
    <span class="checkbox-heading govuk-!-margin-bottom-4">@Messages("confirm-terms-multi.trust.p1", pageConfig.agencyName)</span>
    <ul class="govuk-list govuk-list--bullet">
        <li>@Messages("confirm-terms-multi.trust.list.item1")</li>
        <li>@Messages("confirm-terms-multi.trust.list.item2")</li>
    </ul>
}

@cgtTerms = {
    @if(pageConfig.clientType == "personal") {
        <span class="checkbox-heading govuk-!-margin-bottom-4">@Messages("confirm-terms-multi.cgt.personal.p1", pageConfig.agencyName)</span>
        <ul class="govuk-list govuk-list--bullet">
            <li>@Messages("confirm-terms-multi.cgt.personal.p1.l1")</li>
            <li>@Messages("confirm-terms-multi.cgt.personal.p1.l2")</li>
            <li>@Messages("confirm-terms-multi.cgt.personal.p1.l3")</li>
            <li>@Messages("confirm-terms-multi.cgt.personal.p1.l4")</li>
            <li>@Messages("confirm-terms-multi.cgt.personal.p1.l5")
                <ul class="govuk-list govuk-list--bullet">
                    <li>@Messages("confirm-terms-multi.cgt.personal.p1.l6")</li>
                    <li>@Messages("confirm-terms-multi.cgt.personal.p1.l7")</li>
                    <li>@Messages("confirm-terms-multi.cgt.personal.p1.l8")</li>
                    <li>@Messages("confirm-terms-multi.cgt.personal.p1.l9")</li>
                    <li>@Messages("confirm-terms-multi.cgt.personal.p1.l10")</li>
                </ul>
            </li>
        </ul>
    } else {
        <span class="checkbox-heading govuk-!-margin-bottom-4">@Messages("confirm-terms-multi.cgt.business.p1", pageConfig.agencyName)</span>
        <ul class="govuk-list govuk-list--bullet">
            <li>@Messages("confirm-terms-multi.cgt.business.p1.l1")</li>
            <li>@Messages("confirm-terms-multi.cgt.business.p1.l2")</li>
            <li>@Messages("confirm-terms-multi.cgt.business.p1.l3")</li>
            <li>@Messages("confirm-terms-multi.cgt.business.p1.l4")</li>
            <li>@Messages("confirm-terms-multi.cgt.business.p1.l5")
                <ul class="govuk-list govuk-list--bullet">
                    <li>@Messages("confirm-terms-multi.cgt.business.p1.l6")</li>
                    <li>@Messages("confirm-terms-multi.cgt.business.p1.l7")</li>
                    <li>@Messages("confirm-terms-multi.cgt.business.p1.l8")</li>
                    <li>@Messages("confirm-terms-multi.cgt.business.p1.l9")</li>
                    <li>@Messages("confirm-terms-multi.cgt.business.p1.l10")</li>
                </ul>
            </li>
        </ul>
   }
}

@pptTerms = {
  @if(pageConfig.clientType == "personal") {
    <span class="checkbox-heading govuk-!-margin-bottom-4">@Messages("confirm-terms-multi.ppt.personal.p1", pageConfig.agencyName)</span>
    <ul class="govuk-list govuk-list--bullet">
        <li>@Messages("confirm-terms-multi.ppt.personal.p1.l1")</li>
        <li>@Messages("confirm-terms-multi.ppt.personal.p1.l2")</li>
        <li>@Messages("confirm-terms-multi.ppt.personal.p1.l3")</li>
        <li>@Messages("confirm-terms-multi.ppt.personal.p1.l4")</li>
        <li>@Messages("confirm-terms-multi.ppt.personal.p1.l5")</li>
        <li>@Messages("confirm-terms-multi.ppt.personal.p1.l6")</li>
        <li>@Messages("confirm-terms-multi.ppt.personal.p1.l7")</li>
        <li>@Messages("confirm-terms-multi.ppt.personal.p1.l8")</li>
    </ul>
  } else {
    <span class="checkbox-heading govuk-!-margin-bottom-4">@Messages("confirm-terms-multi.ppt.business.p1", pageConfig.agencyName)</span>
    <ul class="govuk-list govuk-list--bullet">
        <li>@Messages("confirm-terms-multi.ppt.business.p1.l1")</li>
        <li>@Messages("confirm-terms-multi.ppt.business.p1.l2")</li>
        <li>@Messages("confirm-terms-multi.ppt.business.p1.l3")</li>
        <li>@Messages("confirm-terms-multi.ppt.business.p1.l4")</li>
        <li>@Messages("confirm-terms-multi.ppt.business.p1.l5")</li>
        <li>@Messages("confirm-terms-multi.ppt.business.p1.l6")</li>
        <li>@Messages("confirm-terms-multi.ppt.business.p1.l7")</li>
        <li>@Messages("confirm-terms-multi.ppt.business.p1.l8")</li>
    </ul>
  }
}

@suitableTerms(serviceKey: String, expiryDate: String, isAltItsa: Boolean) = {
    @if(isAltItsa) {
        <p>@Messages("confirm-terms-multi.expires.p2", expiryDate)</p>
    }
    @{serviceKey match {
        case "itsa" => itsaTerms
        case "afi" => pirTerms
        case "vat" => vatTerms
        case "trust" => trustTerms
        case "trustNT" => trustNTTerms
        case "cgt" => cgtTerms
        case "ppt" => pptTerms
    }}
    @if(!isAltItsa) {
        <p>@Messages("confirm-terms-multi.expires.p2", expiryDate)</p>
    }
}

@title = @{
   if(changingConsent) Messages("change.consent.heading") else Messages("confirm-terms.multi.heading")
}

@label(serviceKey: String) = @{
    if(pageConfig.clientType == "business" && serviceKey == "cgt") {
        Messages(s"confirm-terms-multi.${serviceKey}.business.label", pageConfig.agencyName)
    } else {
        Messages(s"confirm-terms-multi.${serviceKey}.label", pageConfig.agencyName)
    }
}

@mainTemplate(
bannerTitle = Messages("service.name.clients"),
title =  errorPrefix(confirmTermsForm) +  Messages("generic.title", title, Messages("service.name.clients")),
isAgent = false,
backLinkHref = Some(pageConfig.backLink.url)
) {

    @if(confirmTermsForm.hasErrors) {
        @govukErrorSummary(ErrorSummary().withFormErrorsAsText(confirmTermsForm))
    }

    <h1 class="govuk-heading-xl govuk-!-margin-bottom-4">
        @{if(request.headers.get("Referer").getOrElse("").endsWith(pageConfig.checkAnswersUrl.url)){
        Messages("confirm-terms.multi-individual.heading")
        } else {
        Messages("confirm-terms.multi.heading")}}
    </h1>

    <p>@Messages("confirm-terms.multi.p1", pageConfig.agencyName)</p>

    <p>@Html(Messages("confirm-terms.subheading2.p1", externalUrls.agentClientManagementUrl))</p>

    <p>@Html(Messages("confirm-terms.subheading3.p1", externalUrls.privacypolicyUrl))</p>

    @formHelper(pageConfig.submitUrl) {
    <fieldset class="govuk-fieldset">
        <legend class="govuk-visually-hidden">
            @if(pageConfig.isSingleConsent)@{Messages("confirm-terms.legend.single",pageConfig.agencyName)} else{
            @Messages("confirm-terms.legend.multi",pageConfig.agencyName)
            }
        </legend>

        @for(consent <- pageConfig.serviceKeyAndExpiryDateSeq) {

            @if(pageConfig.isPending(consent)) {

                <h2 class="govuk-!-margin-bottom-4 govuk-!-margin-top-4">@Messages(s"confirm-terms-multi.${if(List("cgt", "ppt").contains(consent.serviceKey)) s"${consent.serviceKey}.${pageConfig.clientType}" else consent.serviceKey}.heading")</h2>

                    @if(pageConfig.consentSeq.length == 1 && pageConfig.consentSeq.head.consent) {
                        @suitableTerms(consent.serviceKey, displayDateForLang(consent.expiryDate), consent.isAltItsa)
                        @inputSingleCheckbox(
                            field = confirmTermsForm(s"confirmedTerms_${consent.serviceKey}"),
                            legend = Messages(s"confirm-terms-multi.${if(List("cgt", "ppt").contains(consent.serviceKey)) s"${consent.serviceKey}.${pageConfig.clientType}" else consent.serviceKey}.heading"),
                            id = consent.serviceKey,
                            checkboxText = label(consent.serviceKey),
                            isChecked = true
                        )
                    } else {
                        @suitableTerms(consent.serviceKey, displayDateForLang(consent.expiryDate), consent.isAltItsa)
                        @inputSingleCheckbox(
                            field = confirmTermsForm(s"confirmedTerms_${consent.serviceKey}"),
                            legend = Messages(s"confirm-terms-multi.${if(List("cgt", "ppt").contains(consent.serviceKey)) s"${consent.serviceKey}.${pageConfig.clientType}" else consent.serviceKey}.heading"),
                            id = consent.serviceKey,
                            checkboxText = label(consent.serviceKey)
                        )
                    }
                <hr class="govuk-section-break govuk-section-break--visible">
            }
        }
    </fieldset>
    @submitButton()
    }

}
