@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.Configuration
@import uk.gov.hmrc.hmrcfrontend.config.ContactFrontendConfig
@import uk.gov.hmrc.agentinvitationsfrontend.config.ExternalUrls
@import uk.gov.hmrc.agentinvitationsfrontend.models.ConfirmedTerms
@import uk.gov.hmrc.agentinvitationsfrontend.util.DisplayDateUtils._
@import uk.gov.hmrc.agentinvitationsfrontend.views.clients.ConfirmTermsPageConfig
@import uk.gov.hmrc.agentinvitationsfrontend.views.html._
@import uk.gov.hmrc.agentinvitationsfrontend.views.html.agents._
@import uk.gov.hmrc.agentinvitationsfrontend.views.html.components.{SubmitButton, InputSingleCheckbox}
@import uk.gov.hmrc.govukfrontend.views.html.components.{GovukErrorSummary, ErrorSummary, FormWithCSRF, Text}
@import uk.gov.hmrc.govukfrontend.views.html.components.implicits._
@import uk.gov.hmrc.hmrcfrontend.views.html.components.implicits._

@this(
    mainTemplate: MainTemplate,
    errorPrefix: error_prefix,
    govukErrorSummary: GovukErrorSummary,
    formHelper: FormWithCSRF,
    submitButton: SubmitButton,
    inputSingleCheckbox: InputSingleCheckbox
)

@(confirmTermsForm: Form[ConfirmedTerms], pageConfig: ConfirmTermsPageConfig, changingConsent: Boolean = false)(implicit request: Request[_], msgs: Messages, configuration: Configuration, externalUrls: ExternalUrls, contactFrontendConfig: ContactFrontendConfig)

@itsaTerms = {
    <p class="govuk-!-margin-bottom-4">@msgs("confirm-terms-multi.itsa.p1", pageConfig.agencyName)</p>
    <ul class="govuk-list govuk-list--bullet">
        <li>@msgs("confirm-terms-multi.itsa.list.item7")</li>
        <li>@msgs("confirm-terms-multi.itsa.list.item1")</li>
        <li>@msgs("confirm-terms-multi.itsa.list.item2")</li>
        <li>@msgs("confirm-terms-multi.itsa.list.item3")</li>
        <li>@msgs("confirm-terms-multi.itsa.list.item4")</li>
        <li>@msgs("confirm-terms-multi.itsa.list.item5")</li>
        <li>@msgs("confirm-terms-multi.itsa.list.item6")</li>
        <li>@msgs("confirm-terms-multi.itsa.list.item8")</li>
        <li>@msgs("confirm-terms-multi.itsa.list.item9")</li>
        <li>@msgs("confirm-terms-multi.itsa.list.item10")</li>
    </ul>
}

@pirTerms = {
    <p class="govuk-!-margin-bottom-4">@msgs("confirm-terms-multi.pir.p1", pageConfig.agencyName)</p>
    <ul class="govuk-list govuk-list--bullet">
        <li>@msgs("confirm-terms-multi.pir.list.item1")</li>
        <li>@msgs("confirm-terms-multi.pir.list.item2")</li>
        <li>@msgs("confirm-terms-multi.pir.list.item3")</li>
        <li>@msgs("confirm-terms-multi.pir.list.item4")</li>
    </ul>
}

@vatTerms = {
    <p class="govuk-!-margin-bottom-4">@msgs("confirm-terms-multi.vat.p1", pageConfig.agencyName)</p>
    <ul class="govuk-list govuk-list--bullet">
        <li>@msgs("confirm-terms-multi.vat.list.item1")</li>
        <li>@msgs("confirm-terms-multi.vat.list.item2")</li>
        <li>@msgs("confirm-terms-multi.vat.list.item3")</li>
        <li>@msgs("confirm-terms-multi.vat.list.item4")</li>
        <li>@msgs("confirm-terms-multi.vat.list.item5")</li>
        <li>@msgs("confirm-terms-multi.vat.list.item6")</li>
        <li>@msgs("confirm-terms-multi.vat.list.item7")
        <ul class="govuk-list govuk-list--bullet">
            <li>@msgs("confirm-terms-multi.vat.list.item8")</li>
            <li>@msgs("confirm-terms-multi.vat.list.item9")</li>
            <li>@msgs("confirm-terms-multi.vat.list.item10")</li>
            <li>@msgs("confirm-terms-multi.vat.list.item11")</li>
        </ul>
        </li>
    </ul>
}

@trustTerms = {
    <p class="govuk-!-margin-bottom-4">@msgs("confirm-terms-multi.trust.p1", pageConfig.agencyName)</p>
    <ul class="govuk-list govuk-list--bullet">
        <li>@msgs("confirm-terms-multi.trust.list.item1")</li>
        <li>@msgs("confirm-terms-multi.trust.list.item2")</li>
    </ul>
}

@trustNTTerms = {
    <p class=" govuk-!-margin-bottom-4">@msgs("confirm-terms-multi.trust.p1", pageConfig.agencyName)</p>
    <ul class="govuk-list govuk-list--bullet">
        <li>@msgs("confirm-terms-multi.trust.list.item1")</li>
        <li>@msgs("confirm-terms-multi.trust.list.item2")</li>
    </ul>
}

@cgtTerms = {
    @if(pageConfig.clientType == "personal") {
        <p class="govuk-!-margin-bottom-4">@msgs("confirm-terms-multi.cgt.personal.p1", pageConfig.agencyName)</p>
        <ul class="govuk-list govuk-list--bullet">
            <li>@msgs("confirm-terms-multi.cgt.personal.p1.l1")</li>
            <li>@msgs("confirm-terms-multi.cgt.personal.p1.l2")</li>
            <li>@msgs("confirm-terms-multi.cgt.personal.p1.l3")</li>
            <li>@msgs("confirm-terms-multi.cgt.personal.p1.l4")</li>
            <li>@msgs("confirm-terms-multi.cgt.personal.p1.l5")
                <ul class="govuk-list govuk-list--bullet">
                    <li>@msgs("confirm-terms-multi.cgt.personal.p1.l6")</li>
                    <li>@msgs("confirm-terms-multi.cgt.personal.p1.l7")</li>
                    <li>@msgs("confirm-terms-multi.cgt.personal.p1.l8")</li>
                    <li>@msgs("confirm-terms-multi.cgt.personal.p1.l9")</li>
                    <li>@msgs("confirm-terms-multi.cgt.personal.p1.l10")</li>
                </ul>
            </li>
        </ul>
    } else {
        <p class="govuk-!-margin-bottom-4">@msgs("confirm-terms-multi.cgt.business.p1", pageConfig.agencyName)</p>
        <ul class="govuk-list govuk-list--bullet">
            <li>@msgs("confirm-terms-multi.cgt.business.p1.l1")</li>
            <li>@msgs("confirm-terms-multi.cgt.business.p1.l2")</li>
            <li>@msgs("confirm-terms-multi.cgt.business.p1.l3")</li>
            <li>@msgs("confirm-terms-multi.cgt.business.p1.l4")</li>
            <li>@msgs("confirm-terms-multi.cgt.business.p1.l5")
                <ul class="govuk-list govuk-list--bullet">
                    <li>@msgs("confirm-terms-multi.cgt.business.p1.l6")</li>
                    <li>@msgs("confirm-terms-multi.cgt.business.p1.l7")</li>
                    <li>@msgs("confirm-terms-multi.cgt.business.p1.l8")</li>
                    <li>@msgs("confirm-terms-multi.cgt.business.p1.l9")</li>
                    <li>@msgs("confirm-terms-multi.cgt.business.p1.l10")</li>
                </ul>
            </li>
        </ul>
   }
}

@pptTerms = {
  @if(pageConfig.clientType == "personal") {
    <p class="govuk-!-margin-bottom-4">@msgs("confirm-terms-multi.ppt.personal.p1", pageConfig.agencyName)</p>
    <ul class="govuk-list govuk-list--bullet">
        <li>@msgs("confirm-terms-multi.ppt.personal.p1.l1")</li>
        <li>@msgs("confirm-terms-multi.ppt.personal.p1.l2")</li>
        <li>@msgs("confirm-terms-multi.ppt.personal.p1.l3")</li>
        <li>@msgs("confirm-terms-multi.ppt.personal.p1.l4")</li>
        <li>@msgs("confirm-terms-multi.ppt.personal.p1.l5")</li>
        <li>@msgs("confirm-terms-multi.ppt.personal.p1.l6")</li>
        <li>@msgs("confirm-terms-multi.ppt.personal.p1.l7")</li>
        <li>@msgs("confirm-terms-multi.ppt.personal.p1.l8")</li>
    </ul>
  } else {
    <p class="govuk-!-margin-bottom-4">@msgs("confirm-terms-multi.ppt.business.p1", pageConfig.agencyName)</p>
    <ul class="govuk-list govuk-list--bullet">
        <li>@msgs("confirm-terms-multi.ppt.business.p1.l1")</li>
        <li>@msgs("confirm-terms-multi.ppt.business.p1.l2")</li>
        <li>@msgs("confirm-terms-multi.ppt.business.p1.l3")</li>
        <li>@msgs("confirm-terms-multi.ppt.business.p1.l4")</li>
        <li>@msgs("confirm-terms-multi.ppt.business.p1.l5")</li>
        <li>@msgs("confirm-terms-multi.ppt.business.p1.l6")</li>
        <li>@msgs("confirm-terms-multi.ppt.business.p1.l7")</li>
        <li>@msgs("confirm-terms-multi.ppt.business.p1.l8")</li>
    </ul>
  }
}

@suitableTerms(serviceKey: String, expiryDate: String, isAltItsa: Boolean) = {
    @if(isAltItsa) {
        <p>@msgs("confirm-terms-multi.expires.p2", expiryDate)</p>
    }
    @{serviceKey match {
        case "itsa" => itsaTerms
        case "afi" => pirTerms
        case "vat" => vatTerms
        case "trust" => trustTerms
        case "trustNT" => trustNTTerms
        case "cgt" => cgtTerms
        case "ppt" => pptTerms
    }}
    @if(!isAltItsa) {
        <p>@msgs("confirm-terms-multi.expires.p2", expiryDate)</p>
    }
}

@title = @{
   if(changingConsent) msgs("change.consent.heading") else msgs("confirm-terms.multi.heading")
}

@label(serviceKey: String) = @{
    if(pageConfig.clientType == "business" && serviceKey == "cgt") {
        msgs(s"confirm-terms-multi.${serviceKey}.business.label", pageConfig.agencyName)
    } else {
        msgs(s"confirm-terms-multi.${serviceKey}.label", pageConfig.agencyName)
    }
}

@mainTemplate(
bannerTitle = msgs("service.name.clients"),
title =  errorPrefix(confirmTermsForm) +  msgs("generic.title", title, msgs("service.name.clients")),
isAgent = false,
backLinkHref = Some(pageConfig.backLink.url)
) {

    @if(confirmTermsForm.hasErrors) {
        @govukErrorSummary(ErrorSummary().withFormErrorsAsText(confirmTermsForm))
    }

    <h1 class="govuk-heading-xl govuk-!-margin-bottom-4">
        @{if(request.headers.get("Referer").getOrElse("").endsWith(pageConfig.checkAnswersUrl.url)){
        msgs("confirm-terms.multi-individual.heading")
        } else {
        msgs("confirm-terms.multi.heading")}}
    </h1>

    <p>@msgs("confirm-terms.multi.p1", pageConfig.agencyName)</p>

    <p>@Html(msgs("confirm-terms.subheading2.p1", externalUrls.agentClientManagementUrl))</p>

    <p>@Html(msgs("confirm-terms.subheading3.p1", externalUrls.privacypolicyUrl))</p>

    @formHelper(pageConfig.submitUrl) {
    <fieldset class="govuk-fieldset">
        <legend class="govuk-visually-hidden">
            @msgs(s"confirm-terms.legend.${if(pageConfig.isSingleConsent) "single" else "multi"}",pageConfig.agencyName)
        </legend>

        @for(consent <- pageConfig.serviceKeyAndExpiryDateSeq) {

            @if(pageConfig.isPending(consent)) {

                <h2 class="govuk-!-margin-bottom-4 govuk-!-margin-top-4">@msgs(s"confirm-terms-multi.${if(List("cgt", "ppt").contains(consent.serviceKey)) s"${consent.serviceKey}.${pageConfig.clientType}" else consent.serviceKey}.heading")</h2>

                @suitableTerms(consent.serviceKey, displayDateForLang(consent.expiryDate), consent.isAltItsa)

                @if(pageConfig.consentSeq.length == 1 && pageConfig.consentSeq.head.consent) {
                    @inputSingleCheckbox(
                        field = confirmTermsForm(s"confirmedTerms_${consent.serviceKey}"),
                        legend = msgs(s"confirm-terms.legend.${if(pageConfig.isSingleConsent) "single" else "multi"}",pageConfig.agencyName),
                        checkboxText = label(consent.serviceKey),
                        isChecked = true
                    )
                } else {
                    @inputSingleCheckbox(
                        field = confirmTermsForm(s"confirmedTerms.${consent.serviceKey}"),
                        legend = msgs(s"confirm-terms.legend.${if(pageConfig.isSingleConsent) "single" else "multi"}",pageConfig.agencyName),
                        checkboxText = label(consent.serviceKey)
                    )
                }

                @if(pageConfig.consentSeq.length != 1) {
                <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
                }
            }
        }
    </fieldset>
    @submitButton()
    }

}
